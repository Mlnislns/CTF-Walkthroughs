\# O5: Take Over an EDR Account

\#\# Problem Description  
Now that you know the EDR tool in use, you've discovered that the best way to take over assets inside of The Lucky Lion is to gain access to the console of the EDR tool. Given the high-privileged rights that EDR Services run as, getting access to this tool should provide unfettered access to The Lucky Lion's resources\!

After taking over the email account utilizing their quished credentials, you learned that the administrator is using a different password for accessing the EDR console. (Yay\!) However, you've discovered the Java application that The Lucky Lion is utilizing for OTP and you've zipped it up as Alg\_Gen.zip (attached in Files). After dissecting the application, it seems to be a promising (albeit disheartening) path\!

To get into the EDR console, you'll need to figure out how to take over the credentials for The Lucky Lion's EDR administrator. How can we go about obtaining the credentials for this user?

\#\# Objective  
Provide the One-Time Password from the vendor to reset the user's password.

Provided: \[alg\_gen.zip\](resources/alg\_gen.zip)

\#\# Approach and Solution  
\# O5: Take Over an EDR Account

\#\# Problem Description  
Now that you know the EDR tool in use, you've discovered that the best way to take over assets inside of The Lucky Lion is to gain access to the console of the EDR tool. Given the high-privileged rights that EDR Services run as, getting access to this tool should provide unfettered access to The Lucky Lion's resources\!

After taking over the email account utilizing their quished credentials, you learned that the administrator is using a different password for accessing the EDR console. (Yay\!) However, you've discovered the Java application that The Lucky Lion is utilizing for OTP and you've zipped it up as Alg\_Gen.zip (attached in Files). After dissecting the application, it seems to be a promising (albeit disheartening) path\!

To get into the EDR console, you'll need to figure out how to take over the credentials for The Lucky Lion's EDR administrator. How can we go about obtaining the credentials for this user?

\#\# Objective  
Provide the One-Time Password from the vendor to reset the user's password.

Provided: \[alg\_gen.zip\](resources/alg\_gen.zip)

\#\# Approach and Solution

As a rule of thumb, whenever I’m given source code for a challenge, I start by performing basic static analysis. My approach usually involves:  
1\) Understanding the program’s purpose.  
2\) Examining how it achieves that goal—what methods, libraries, or tools are used?  
3\) Identifying potential vulnerabilities and figuring out how to exploit them.

While this challenge doesn’t require deep analysis, quickly grasping the code’s logic is essential.

First, when we unzip the \`alg\_gen\` file, we find three folders: \`\_\_MACOSX\`, \`.gradle\`, and \`alg\_gen\`. The source code is inside the \`alg\_gen\` folder, so that’s where we focus. Within \`alg\_gen\`, there’s a \`src\` folder containing all the source files. Navigating to \`src/main/java\`, we find subfolders named \`Controllers\`, \`Helpers\`, \`Models\`, and \`Services\`. Controllers typically handle backend logic—exactly what we need.

Sure enough, in the \`Controllers\` folder, we find a file named \`GeneratorController.java\` containing a \`generate\_token\` function and a mapping to the \`/generate\` URL:

\`\`\`java  
@GetMapping("/generate")  
public String generate\_token(  
    @RequestParam(value \= "email", required \= true) String email) {

    return tokenGeneratorService.generate\_token();  
}

@PostMapping("validate")  
public Boolean verify\_token() {

    return true;  
}  
\`\`\`

This function calls \`tokenGeneratorService.generate\_token()\`. In the \`Services\` folder, there’s a file called \`TokenGeneratorService.java\`, which contains the core token generation logic:

\`\`\`java  
public class TokenGeneratorService {

    public String generate\_token() {  
        return General\_Helpers.getTimestamp().replaceAll("\[-: \]", "").substring(6,12);  
    }  
}  
\`\`\`

Great\! 

From the code, we can tell the token is generated by taking the current timestamp, stripping non-numeric characters, and selecting six digits from indices 6 to 12\. But we need to understand exactly how the timestamp is formatted.

The \`generate\_token()\` function relies on \`General\_Helpers.getTimestamp()\`, found in \`General\_Helpers.java\` under the \`Helpers\` folder. This file defines the timestamp format using:

\`final SimpleDateFormat simpleDateFormat \= new SimpleDateFormat("MM/dd/yyyy HH:mm a z");\`

This gives us the format.

For instance, a date like "01/01/70 01:23:45AM" would produce the token \`700123\`. We can easily replicate this logic in Python:

\`\`\`python  
from datetime import datetime

def get\_timestamp():  
    return datetime.now().strftime("%m/%d/%y %I:%M:%S%p")

def generate\_token():  
    timestamp \= get\_timestamp()  
    cleaned\_timestamp \= timestamp.replace("-", "").replace(":", "").replace(" ", "")  
    otp \= cleaned\_timestamp\[6:12\]  
    return otp

if \_\_name\_\_ \== "\_\_main\_\_":  
    token \= generate\_token()  
    print(f"Generated OTP: {token}")  
\`\`\`

However, when we submit the generated token, it fails. Uh oh\! It turns out the token needs to be generated from a \*specific\* date and time. But how do we find that?

Let’s do some recon.

The instructions mentioned: "After taking over the email account using the compromised credentials, you discover that the administrator uses a different password for the EDR console." So, maybe there’s a clue in the email account?

After some searching… yes\! We find it\!

![image](https://github.com/user-attachments/assets/f32f8028-3509-4089-a8fc-398e7a7be1e3)


In the Junk folder, there’s an email from CyberGuardianPro with an OTP code. We take the timestamp from that email (05/24/24 12:23:45PM) and run it through our script.

This gives us \`241223\` as the OTP.

